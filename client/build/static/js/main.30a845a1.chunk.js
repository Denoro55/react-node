(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{113:function(e,a){},125:function(e,a,t){},126:function(e,a,t){},127:function(e,a,t){},129:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),c=t(32),s=t.n(c),o=t(5),l=t(10),i=t(6),m=t(9),u=t(12),d=t(13),p=t(14),f=t(17),v=function(e){Object(d.a)(t,e);var a=Object(p.a)(t);function t(){return Object(m.a)(this,t),a.apply(this,arguments)}return Object(u.a)(t,[{key:"componentDidMount",value:function(){console.log(this.props)}},{key:"render",value:function(){return r.a.createElement("div",null,"cart")}}]),t}(r.a.Component),E=function(e,a){return function(){return function(t){return t({type:"GET_USER"}),e.getUserData(a).then((function(e){var n={auth:!0,token:a,name:e.data.name,id:e.data.id,avatarUrl:e.data.avatarUrl};return t({type:"GET_USER_SUCCESS",payload:n})})).catch((function(e){t({type:"GET_USER_FAILURE"})}))}}},h=(t(84),t(67)),g=t.n(h)()("http://localhost:3000"),_=Object(o.b)((function(e){return{isAuthenticated:e.user.auth,user:e.user}}),(function(e){return{actionUnauthorize:function(){return e((localStorage.removeItem("userData"),{type:"USER_UNAUTHORIZE"}))}}}))((function(e){var a=e.isAuthenticated,t=e.actionUnauthorize,n=e.user,c=function(e){e.preventDefault(),g.emit("leaveRoom",{id:n.id}),t()};return r.a.createElement("header",{className:"header"},r.a.createElement("nav",null,r.a.createElement("div",{className:"nav-wrapper"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col s12"},r.a.createElement(l.b,{className:"navbar-brand left",to:"/"},"Art's Store"),r.a.createElement("ul",{id:"nav-mobile",className:"left hide-on-med-and-down"},[{exact:!0,to:"/",name:"Home",isAuth:!1},{exact:!0,to:"/me",name:"Me",isAuth:!0},{exact:!1,to:"/store",name:"Store",isAuth:!1},{exact:!1,to:"/messages/",name:"Messages",isAuth:!0}].map((function(e,t){return!a&&e.isAuth?null:r.a.createElement("li",{key:t,className:"nav-item"},r.a.createElement(l.c,{activeClassName:"active",className:"nav-link",exact:e.exact,to:e.to},e.name))}))),a?r.a.createElement("ul",{className:"navbar-nav ml-3 right"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(l.c,{onClick:c,activeClassName:"active",className:"nav-link ml-auto",to:"/logout"},"Logout"))):r.a.createElement("ul",{id:"nav-mobile",className:"right hide-on-med-and-down"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(l.c,{activeClassName:"active",className:"nav-link ml-auto",to:"/login"},"Login")),r.a.createElement("li",{className:"nav-item"},r.a.createElement(l.c,{activeClassName:"active",className:"nav-link ml-2",to:"/register"},"Register")))))))))})),N=Object(o.b)((function(e){return{user:e.user}}))((function(e){var a=e.user,t=a.auth?r.a.createElement("p",null,"Hello, ",r.a.createElement("b",null,a.name)):r.a.createElement("p",null,"Hello, Guest!");return r.a.createElement("div",null,r.a.createElement("h3",{className:"mb-3"},"Home page 2"),t)})),b=function(e){Object(d.a)(t,e);var a=Object(p.a)(t);function t(){return Object(m.a)(this,t),a.apply(this,arguments)}return Object(u.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return r.a.createElement("h3",null,"Store page")}}]),t}(r.a.Component),S=t(74),y=Object(o.b)((function(e){return{auth:e.user.auth}}))((function(e){var a=e.component,t=e.auth,n=Object(S.a)(e,["component","auth"]);return r.a.createElement(f.b,null,t?r.a.createElement(a,n):r.a.createElement(f.a,{to:"/login"}))})),O=t(23),C=r.a.createContext(),j=C.Provider,w=C.Consumer,T=function(e){return function(a){return r.a.createElement(w,null,(function(t){return r.a.createElement(e,Object.assign({},a,{apiService:t}))}))}},k=function(e){Object(d.a)(t,e);var a=Object(p.a)(t);function t(){var e;Object(m.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=a.call.apply(a,[this].concat(r))).state={form:{email:"",password:""},message:{color:"red",text:""}},e.login=function(a){a.preventDefault();var t=e.props,n=t.apiService,r=t.actionAuthorize,c=t.actionGetUserData;n.login(e.state.form).then((function(a){if(a.errors)e.setState({message:{color:"red",text:a.message}});else{var t=a.token;t&&(r({auth:!0,token:t}),c(t).then((function(a){g.emit("connected",{id:a.payload.id}),e.props.history.push("/me")})))}}))},e.onInputChange=function(a){e.setState({form:Object(i.a)({},e.state.form,Object(O.a)({},a.target.name,a.target.value))})},e}return Object(u.a)(t,[{key:"render",value:function(){var e=this.state.message,a=e.text?r.a.createElement("div",{className:"mb-3",style:{color:e.color}},e.text):null;return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-4"},r.a.createElement("h3",{className:"mb-4"},"Login"),r.a.createElement("form",{onSubmit:this.login},r.a.createElement("div",{className:"mb-3"},r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",onChange:this.onInputChange,name:"email",className:"form-control",placeholder:"Email"})),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"password",onChange:this.onInputChange,name:"password",className:"form-control",placeholder:"Password"}))),a,r.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Sign in")))))}}]),t}(r.a.Component),A=T(Object(o.b)((function(e){return{token:e.user.token}}),(function(e,a){var t=a.apiService;a.token;return{actionGetUserData:function(a){return e(E(t,a)())},actionAuthorize:function(a){return e(function(e){var a=e.auth,t=e.token;return localStorage.setItem("userData",t),{type:"USER_AUTHORIZE",payload:{auth:a,token:t}}}(a))}}}))(k)),U=function(e){Object(d.a)(t,e);var a=Object(p.a)(t);function t(){var e;Object(m.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=a.call.apply(a,[this].concat(r))).state={form:{name:"",email:"",password:""},message:{color:"red",text:""}},e.register=function(a){a.preventDefault(),e.props.apiService.register(e.state.form).then((function(a){var t=a.errors?"red":"green";a.errors?e.setState({message:{color:t,text:a.message}}):e.setState({message:{color:t,text:a.message},form:{name:"",email:"",password:""}})})).catch((function(e){console.log(e)}))},e.onInputChange=function(a){e.setState({form:Object(i.a)({},e.state.form,Object(O.a)({},a.target.name,a.target.value))})},e}return Object(u.a)(t,[{key:"render",value:function(){var e=this.state.message,a=e.text?r.a.createElement("div",{className:"mb-3",style:{color:e.color}},e.text):null;return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-4"},r.a.createElement("h3",{className:"mb-4"},"Register"),r.a.createElement("form",{onSubmit:this.register},r.a.createElement("div",{className:"mb-3"},r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",onChange:this.onInputChange,name:"name",className:"form-control",placeholder:"Name",value:this.state.form.name})),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",onChange:this.onInputChange,name:"email",className:"form-control",placeholder:"Email",value:this.state.form.email})),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"password",onChange:this.onInputChange,name:"password",className:"form-control",placeholder:"Password",value:this.state.form.password}))),a,r.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Register"))))}}]),t}(r.a.Component),I=T(Object(o.b)((function(e){return{}}),(function(e){return{checkAuth:function(){}}}))(U)),M=t(18),x=Object(f.g)((function(e){var a=e.messagesList,t=e.openChat;return r.a.createElement("ul",{className:"collection with-header"},a.map((function(e,a){return r.a.createElement("li",{key:a,className:"collection-item"},r.a.createElement("div",{className:"message-item"},r.a.createElement("div",{className:"message-item__content"},r.a.createElement("div",{className:"message-item__avatar"},r.a.createElement("div",{className:"message-item__avatar-icon"})),r.a.createElement("div",{className:"message-item__info"},r.a.createElement("div",{className:"message-item__name"},r.a.createElement("strong",null,e.name)),r.a.createElement("div",{className:"message-item__text"},e.text))),r.a.createElement("div",{className:"message-item__actions"},e.updated?r.a.createElement("button",{onClick:function(){return t(e.id)},className:"btn btn-outline btn-danger btn-sm"},r.a.createElement("i",{className:"fa fa-envelope-open"})):null,r.a.createElement("button",{onClick:function(){return t(e.id)},className:"btn btn-outline btn-success btn-sm ml-3"},r.a.createElement("i",{className:"fa fa-weixin"})))))})))})),D=function(){return r.a.createElement("div",{className:"preloader-wrapper big active"},r.a.createElement("div",{className:"spinner-layer spinner-blue-only"},r.a.createElement("div",{className:"circle-clipper left"},r.a.createElement("div",{className:"circle"})),r.a.createElement("div",{className:"gap-patch"},r.a.createElement("div",{className:"circle"})),r.a.createElement("div",{className:"circle-clipper right"},r.a.createElement("div",{className:"circle"}))))},R=t(7),H=function(e){return function(a){return function(t){var n;t({type:"FETCH_MESSAGES",payload:n}),e.getListMessages(a).then((function(e){t(function(e){return{type:"FETCH_MESSAGES_SUCCESS",payload:e}}(e.messages))}))}}},L=function(e){return{type:"MESSAGE_UPDATE",payload:e}},P=function(e){return{type:"MESSAGES_LIST_UPDATE",payload:e}},G=function(e){return{type:"MESSAGES_LIST_SORT",payload:e.id}},F=function(e){return function(a,t){return function(n){return n({type:"FETCH_CHAT"}),e.getChatMessages(a,t).then((function(e){n({type:"FETCH_CHAT_SUCCESS",payload:e}),n(L({id:t,updated:!1,sort:!1}))}))}}},q=function(e){return{type:"CHAT_STATUS_UPDATE",payload:{inChat:e.inChat,chatId:e.chatId}}},J=function(e){return{type:"CHAT_MESSAGE_ADD",payload:{name:e.name,text:e.text}}},z=function(e){return function(a,t,n,r){return function(c){var s=a.id,o={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.token)},body:JSON.stringify({id:s,senderId:t.id,message:n,companion:a,date:r})};return e.getRequest("sendMessage",o)}}},B=T(Object(o.b)((function(e){return{user:e.user}}),(function(e,a){var t=a.apiService;return Object(R.b)({fetchChat:F(t),actionUpdateChatStatus:q,addChatMessage:J,actionSendMessage:z(t)},e)}))((function(e){var a=e.backToMessages,t=e.chatLoading,c=e.user,s=e.companionId,l=e.fetchChat,i=e.actionUpdateChatStatus,m=e.actionSendMessage,u=(e.addChatMessage,Object(n.useState)("")),d=Object(M.a)(u,2),p=d[0],f=d[1],v=Object(o.c)((function(e){return e.chat.messages})),E=Object(o.c)((function(e){return e.chat.companion})),h=Object(n.useRef)(null);Object(n.useEffect)((function(){return i({inChat:!0,chatId:s}),l(c.id,s),function(){i({inChat:!1,chatId:null})}}),[]),Object(n.useEffect)((function(){h.current.scrollTop=h.current.scrollHeight}),[v]);return r.a.createElement("div",{className:"chat"},r.a.createElement("div",{className:"chat__back"},r.a.createElement("button",{onClick:a,className:"btn btn-primary"},"Back")),r.a.createElement("div",{className:"chat__block"},r.a.createElement("div",{className:"chat__left"},t?r.a.createElement(D,null):r.a.createElement("div",{ref:h,className:"chat__list"},v.map((function(e,a){return r.a.createElement("div",{key:a,className:"chat__item"},r.a.createElement("strong",null,e.name),": ",e.text)}))),r.a.createElement("div",{className:"chat__control"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault();var a={id:s,name:E.name};!function(e,a){var t={name:c.name,text:e},n=Date.now();m(a,c,t,n),g.emit("sendMessage",{toId:s,fromId:c.id,companion:a,date:n,message:t})}(p,a),f("")},className:"chat-control"},r.a.createElement("div",{className:"chat-control__left"},r.a.createElement("input",{onChange:function(e){return f(e.target.value)},type:"text",className:"form-control",value:p})),r.a.createElement("div",{className:"chat-control__right"},r.a.createElement("button",{className:"btn btn-success"},"Send"))))),r.a.createElement("div",{className:"chat__right"},r.a.createElement("div",{className:"chat__companion"},E.name||r.a.createElement(D,null)))))}))),X=t(69),Z=t.n(X),W=(t(125),T(Object(o.b)((function(e){return{user:e.user,messages:e.messages}}),(function(e,a){var t=a.apiService;return Object(R.b)({actionFetchMessages:H(t),updateMessagesList:P},e)}))(Object(f.g)((function(e){var a=e.user,t=e.actionFetchMessages,c=Z.a.parse(e.location.search),s=!1;c.chat&&(s=!0);var l=Object(n.useState)(s),i=Object(M.a)(l,2),m=i[0],u=i[1],d=Object(o.c)((function(e){return e.chat.loading})),p=Object(o.c)((function(e){return e.messages.loading})),f=Object(o.c)((function(e){return e.messages.messages}));Object(n.useEffect)((function(){t(a.id)}),[]);var v=m?r.a.createElement(B,{backToMessages:function(){e.history.push("./"),u(!1)},companionId:c.chat,chatLoading:d}):r.a.createElement(x,{openChat:function(a){return u({show:!0,receiverId:t=a}),void e.history.push("?chat=".concat(t));var t},messagesList:f});return r.a.createElement("div",{className:"container"},r.a.createElement("h3",{className:"mb-4"},"Messages"),p?r.a.createElement(D,null):r.a.createElement("div",{className:"messages"},r.a.createElement("div",{className:"messages__left"},v)))}))))),V=t(70),K=t.n(V),$=(t(126),T(Object(o.b)((function(e){return{user:e.user}}))((function(e){var a=e.apiService,t=e.user,c=t.name,s=t.id,o=t.token,l=t.avatarUrl,i=Object(n.useRef)(null),m=Object(n.useState)(!1),u=Object(M.a)(m,2),d=u[0],p=u[1],f=Object(n.useState)(null),v=Object(M.a)(f,2),E=v[0],h=v[1],g=function(){p(!1),i.current.value=null},_=K()({"profile__avatar-form":!0,active:d});return r.a.createElement("div",{className:"profile"},r.a.createElement("div",{className:"profile__top"},r.a.createElement("div",{className:"profile__background",style:{backgroundImage:"url(https://images2.alphacoders.com/209/thumb-1920-209080.jpg)"}}),r.a.createElement("div",{className:"profile__info"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"profile-info"},r.a.createElement("div",{className:"profile-info__list"},r.a.createElement("div",{className:"profile-info__item"},r.a.createElement("div",{className:"profile-info__value"},"0"),r.a.createElement("div",{className:"profile-info__key"},"Followers")),r.a.createElement("div",{className:"profile-info__item"},r.a.createElement("div",{className:"profile-info__value"},"0"),r.a.createElement("div",{className:"profile-info__key"},"Following")),r.a.createElement("div",{className:"profile-info__item"},r.a.createElement("div",{className:"profile-info__value"},"0"),r.a.createElement("div",{className:"profile-info__key"},"Photos")),r.a.createElement("div",{className:"profile-info__item"},r.a.createElement("div",{className:"profile-info__value"},"0"),r.a.createElement("div",{className:"profile-info__key"},"Posts")))))),r.a.createElement("div",{className:"profile__avatar"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"profile__avatar-image",style:{backgroundImage:"url(/images/".concat(l,")")}},r.a.createElement("div",{className:_},r.a.createElement("form",{onSubmit:function(e){e.preventDefault();var t=new FormData;t.append("avatar",i.current.files[0]),t.append("id",s),a.uploadAvatar(t,o).then((function(e){console.log("avatar uploaded"),g()}))},className:"avatar-form"},r.a.createElement("label",{className:"avatar-form__label"},"Upload a new photo",r.a.createElement("input",{ref:i,onChange:function(e){var a=e.target.files[0];if(a){p(!0);var t=new FileReader;t.readAsDataURL(a),t.onloadend=function(){var e=t.result;h(e)}}else p(!1)},type:"file"})),r.a.createElement("div",{className:"avatar-form__content"},r.a.createElement("div",{className:"avatar-form__preview",style:{backgroundImage:"url(".concat(E,")")}}),r.a.createElement("div",{className:"avatar-form__actions"},r.a.createElement("div",{className:"avatar-form__apply"},r.a.createElement("button",{type:"submit",className:"btn"},"Apply")),r.a.createElement("div",{className:"avatar-form__cancel"},r.a.createElement("div",{onClick:g,className:"btn btn-danger"},"Cancel")))))))))),r.a.createElement("div",{className:"profile__bottom"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"profile__name"},c),r.a.createElement("div",{className:"profile__wall"},r.a.createElement("div",{className:"profile__wall-bar"}),r.a.createElement("div",{className:"profile__wall-left"},r.a.createElement("div",{className:"profile-wall"},r.a.createElement("div",{className:"profile-wall__create"},r.a.createElement("div",{className:"post-create"},r.a.createElement("div",{className:"post-create__icon"},r.a.createElement("div",{className:"post-icon"},r.a.createElement("i",{className:"fa fa-comments-o","aria-hidden":"true"}))),r.a.createElement("div",{className:"post-create__wrap"},r.a.createElement("div",{className:"post-create__input"},r.a.createElement("textarea",{placeholder:"Write a new post...",className:"textarea-theme",name:"",id:"",cols:"30",rows:"10"})),r.a.createElement("div",{className:"post-create__actions"},r.a.createElement("div",{className:"post-create__action"},r.a.createElement("button",{className:"btn"},r.a.createElement("i",{className:"fa fa-picture-o","aria-hidden":"true"}))),r.a.createElement("div",{className:"post-create__action"},r.a.createElement("button",{className:"btn"},"Post")))))),r.a.createElement("div",{className:"profile-wall__list"},r.a.createElement("div",{className:"profile-wall__item"},r.a.createElement("div",{className:"profile-post"},r.a.createElement("div",{className:"profile-post__icon"},r.a.createElement("div",{className:"post-icon post-icon_green"},r.a.createElement("i",{className:"fa fa-picture-o","aria-hidden":"true"}))),r.a.createElement("div",{className:"profile-post__head"},r.a.createElement("div",{className:"profile-post__head-left"},r.a.createElement("span",{className:"profile-post__name"},"Denis")," posted a photo"),r.a.createElement("div",{className:"profile-post__head-right"},"22 min ago")),r.a.createElement("div",{className:"profile-post__image"},r.a.createElement("img",{src:"https://vodabereg.ru/wp-content/uploads/2016/08/serfing.jpg",alt:""}),r.a.createElement("div",{className:"post-info"},r.a.createElement("div",{className:"post-info__comments"},r.a.createElement("i",{className:"fa fa-comment-o","aria-hidden":"true"}),"21 Comments"),r.a.createElement("div",{className:"post-info__likes"},r.a.createElement("i",{className:"fa fa-heart-o","aria-hidden":"true"})," 12 Likes"))))),r.a.createElement("div",{className:"profile-wall__item"},r.a.createElement("div",{className:"profile-post"},r.a.createElement("div",{className:"profile-post__icon"},r.a.createElement("div",{className:"post-icon post-icon_tomato"},r.a.createElement("i",{className:"fa fa-pencil","aria-hidden":"true"}))),r.a.createElement("div",{className:"profile-post__head"},r.a.createElement("div",{className:"profile-post__head-left"},r.a.createElement("span",{className:"profile-post__name"},"Denis")," posted an article"),r.a.createElement("div",{className:"profile-post__head-right"},"55 min ago")),r.a.createElement("div",{className:"profile-post__body"},r.a.createElement("div",{className:"profile-post__content"},"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam amet at consequatur, corporis delectus deserunt, distinctio error expedita facilis magnam, odio odit placeat rerum soluta vel veritatis voluptas. Blanditiis, molestias!")),r.a.createElement("div",{className:"profile-post__info"},r.a.createElement("div",{className:"post-info"},r.a.createElement("div",{className:"post-info__comments"},r.a.createElement("i",{className:"fa fa-comment-o","aria-hidden":"true"})," 21 Comments"),r.a.createElement("div",{className:"post-info__likes"},r.a.createElement("i",{className:"fa fa-heart-o","aria-hidden":"true"})," 12 Likes"))))))))))))})))),Q=function(e){Object(d.a)(t,e);var a=Object(p.a)(t);function t(){return Object(m.a)(this,t),a.apply(this,arguments)}return Object(u.a)(t,[{key:"componentDidUpdate",value:function(e,a,t){console.log(e,this.props)}},{key:"getUser",value:function(){return this.props.user}},{key:"componentDidMount",value:function(){var e=this,a=this.props,t=a.apiService,n=a.updateMessageInList,r=a.addChatMessage;g.on("getMessage",(function(a){var c=e.getUser(),s=e.props.chat,o=s.inChat,l=s.chatId,m=a.fromId.toString()===c.id.toString(),u=Object(i.a)({},a.message);m&&(u.name=a.companion.name,n({id:a.toId,updated:!1,message:u,sort:!0})),!o||l.toString()!==a.toId.toString()&&l.toString()!==a.fromId.toString()?m||(window.M.toast({html:"<b>".concat(a.message.name,"</b>: ").concat(a.message.text)}),n({id:a.fromId,updated:!0,message:u,sort:!0})):(r(a.message),m||(t.updateChatTime(c.id,a.fromId,a.date),n({id:a.fromId,updated:!1,message:u,sort:!0})))}))}},{key:"longpoll",value:function(){}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(_,null),r.a.createElement("div",{className:"content pt-3"},r.a.createElement(f.d,null,r.a.createElement(f.b,{path:"/",exact:!0,component:N}),r.a.createElement(y,{exact:!0,path:"/cart",component:v}),r.a.createElement(f.b,{path:"/store",component:b}),r.a.createElement(y,{exact:!0,path:"/me",component:$}),r.a.createElement(y,{exact:!0,path:"/messages/",component:W}),r.a.createElement(f.b,{path:"/login",component:A}),r.a.createElement(f.b,{path:"/register",component:I}),r.a.createElement(f.b,{path:"/test",render:function(){return r.a.createElement("h2",null,"Test page")}}))))}}]),t}(r.a.Component),Y=T(Object(o.b)((function(e){return{getNewMessage:e.messages.getNewMessage,user:e.user,chat:e.chat}}),(function(e){return Object(R.b)({updateMessageInList:L,sortMessagesList:G,addChatMessage:J},e)}))(Q));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ee=t(73),ae=function(e){Object(d.a)(t,e);var a=Object(p.a)(t);function t(){var e;Object(m.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=a.call.apply(a,[this].concat(r))).status=401,e}return t}(Object(ee.a)(Error)),te=function(){function e(){var a=this;Object(m.a)(this,e),this.URL="/api/",this.getUserData=function(e){return a.getRequest("userData",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}})},this.getChatMessages=function(e,t){return a.getRequest("chatMessages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,receiverId:t})})},this.getListMessages=function(e){return a.getRequest("listMessages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})}}return Object(u.a)(e,[{key:"getRequest",value:function(e){var a=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,r){fetch("".concat(a.URL).concat(e),t).then((function(e){return 401===e.status&&r(new ae),e.json()})).then((function(e){return n(e)}))}))}},{key:"login",value:function(e){return this.getRequest("login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}},{key:"register",value:function(e){return console.log(JSON.stringify(e)),this.getRequest("register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}},{key:"uploadAvatar",value:function(e,a){return this.getRequest("uploadAvatar",{method:"POST",headers:{Authorization:"Bearer ".concat(a)},body:e})}},{key:"updateChatTime",value:function(e,a,t){return this.getRequest("chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,receiverId:a,date:t})})}}]),e}(),ne=(t(127),{name:null,auth:!1,token:null,id:null,avatarUrl:null}),re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"GET_USER_SUCCESS":case"AUTH_CHECK_SUCCESS":case"USER_AUTHORIZE":return Object(i.a)({},e,{},a.payload);case"USER_UNAUTHORIZE":return Object(i.a)({},ne);default:return e}},ce=t(37),se={loading:!0,messages:[]},oe=function(e,a,t,n){return{name:e,text:a,id:t,updated:n}},le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"FETCH_MESSAGES":return{loading:!0,messages:[]};case"FETCH_MESSAGES_SUCCESS":return{loading:!1,messages:a.payload};case"MESSAGE_UPDATE":var t=a.payload,n=t.id,r=t.updated,c=t.message,s=t.sort,o=void 0===s||s,l=e.messages.findIndex((function(e){return e.id===n})),m=Object(ce.a)(e.messages);if(o){var u=c.name,d=c.text;l>=0&&(u=m[l].name,m=m.filter((function(e){return e.id!==n}))),m.unshift(oe(u,d,n,r))}else l>=0&&(m[l].updated=r);return Object(i.a)({},e,{messages:m});case"MESSAGES_LIST_UPDATE":return Object(i.a)({},e,{messages:a.payload});default:return e}},ie={messages:[],loading:!1,inChat:!1,chatId:null,companion:{}},me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"FETCH_CHAT":return Object(i.a)({},e,{loading:!0});case"FETCH_CHAT_SUCCESS":return Object(i.a)({},e,{messages:a.payload.messages,companion:{name:a.payload.companion.name},loading:!1});case"CHAT_STATUS_UPDATE":var t=a.payload,n=t.inChat,r=void 0!==n&&n,c=t.chatId,s=void 0===c?null:c;return Object(i.a)({},e,{inChat:r,chatId:s});case"CHAT_MESSAGE_ADD":return Object(i.a)({},e,{messages:[].concat(Object(ce.a)(e.messages),[a.payload])});default:return e}},ue=Object(R.c)({user:re,messages:le,chat:me}),de=t(71),pe=t(72);t(19),t(38),new te;var fe=Object(pe.a)(),ve=window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__(),Ee=Object(R.e)(ue,Object(R.d)(Object(R.a)(de.a,fe,(function(){return function(e){return function(a){return console.log(a),e(a)}}})),ve)),he=new te,ge=localStorage.getItem("userData");function _e(){s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(o.a,{store:Ee},r.a.createElement(j,{value:he},r.a.createElement(l.a,null,r.a.createElement(Y,null))))),document.getElementById("root"))}g.on("connect",(function(){ge?Ee.dispatch(E(he,ge)()).then((function(e){_e();var a=Ee.getState().user.id;g.emit("connected",{id:a})})):_e()})),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},75:function(e,a,t){e.exports=t(129)},84:function(e,a,t){}},[[75,1,2]]]);
//# sourceMappingURL=main.30a845a1.chunk.js.map