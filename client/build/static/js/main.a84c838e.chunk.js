(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{48:function(e,t,a){e.exports=a(75)},57:function(e,t,a){},71:function(e,t,a){},72:function(e,t,a){},73:function(e,t,a){},75:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(26),s=a.n(r),o=a(5),l=a(9),i=a(10),u=a(12),m=a(13),d=a(14),p=a(17),h=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"componentDidMount",value:function(){console.log(this.props)}},{key:"render",value:function(){return c.a.createElement("div",null,"cart")}}]),a}(c.a.Component),f=function(e,t){return function(){return function(a){return a({type:"GET_USER"}),e.getUserData(t).then((function(e){var n={auth:!0,token:t,name:e.data.name,id:e.data.id};a({type:"GET_USER_SUCCESS",payload:n})})).catch((function(e){a({type:"GET_USER_FAILURE"})}))}}},g=(a(57),Object(o.b)((function(e){return{isAuthenticated:e.user.auth}}),(function(e){return{actionUnauthorize:function(){return e((localStorage.removeItem("userData"),{type:"USER_UNAUTHORIZE"}))}}}))((function(e){var t=e.isAuthenticated,a=e.actionUnauthorize,n=function(e){e.preventDefault(),a()};return c.a.createElement("header",{className:"header"},c.a.createElement("nav",null,c.a.createElement("div",{className:"nav-wrapper"},c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col s12"},c.a.createElement(l.b,{className:"navbar-brand left",to:"/"},"Art's Store"),c.a.createElement("ul",{id:"nav-mobile",className:"left hide-on-med-and-down"},[{exact:!0,to:"/",name:"Home",isAuth:!1},{exact:!0,to:"/me",name:"Me",isAuth:!0},{exact:!1,to:"/store",name:"Store",isAuth:!1},{exact:!1,to:"/messages/",name:"Messages",isAuth:!0}].map((function(e,a){return!t&&e.isAuth?null:c.a.createElement("li",{key:a,className:"nav-item"},c.a.createElement(l.c,{activeClassName:"active",className:"nav-link",exact:e.exact,to:e.to},e.name))}))),t?c.a.createElement("ul",{className:"navbar-nav ml-3 right"},c.a.createElement("li",{className:"nav-item"},c.a.createElement(l.c,{onClick:n,activeClassName:"active",className:"nav-link ml-auto",to:"/logout"},"Logout"))):c.a.createElement("ul",{id:"nav-mobile",className:"right hide-on-med-and-down"},c.a.createElement("li",{className:"nav-item"},c.a.createElement(l.c,{activeClassName:"active",className:"nav-link ml-auto",to:"/login"},"Login")),c.a.createElement("li",{className:"nav-item"},c.a.createElement(l.c,{activeClassName:"active",className:"nav-link ml-2",to:"/register"},"Register"))))))))}))),E=a(22),v=Object(o.b)((function(e){return{user:e.user}}))((function(e){var t=e.user,a=t.auth?c.a.createElement("p",null,"Hello, ",c.a.createElement("b",null,t.name)):c.a.createElement("p",null,"Hello, Guest!");return c.a.createElement("div",null,c.a.createElement("h3",{className:"mb-3"},"Home page"),c.a.createElement(b,null),a)}));function b(){var e=function(){var e=Object(n.useState)(0),t=Object(E.a)(e,2),a=t[0],c=t[1];return{count:a,setCount:Object(n.useCallback)((function(e){c(e)}),[])}}(),t=e.count,a=e.setCount;return Object(n.useEffect)((function(){console.log("useEffect function changed")}),[a]),c.a.createElement("div",null,c.a.createElement("p",null,"You clicked ",t," times"),c.a.createElement("button",{onClick:function(){return a(t+1)}},"Click me"))}var S=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"componentDidMount",value:function(){console.log(this.props)}},{key:"render",value:function(){return c.a.createElement("h3",null,"Store page")}}]),a}(c.a.Component),N=a(47),y=Object(o.b)((function(e){return{auth:e.user.auth}}))((function(e){var t=e.component,a=e.auth,n=Object(N.a)(e,["component","auth"]);return c.a.createElement(p.b,null,a?c.a.createElement(t,n):c.a.createElement(p.a,{to:"/login"}))})),O=a(21),C=a(8),j=c.a.createContext(),_=j.Provider,T=j.Consumer,A=function(e){return function(t){return c.a.createElement(T,null,(function(a){return c.a.createElement(e,Object.assign({},t,{apiService:a}))}))}},k=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,c=new Array(n),r=0;r<n;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).state={form:{email:"",password:""},message:{color:"red",text:""}},e.login=function(t){t.preventDefault();var a=e.props,n=a.apiService,c=a.actionAuthorize,r=a.actionGetUserData;n.login(e.state.form).then((function(t){if(t.errors)e.setState({message:{color:"red",text:t.message}});else{var a=t.token;a&&(c({auth:!0,token:a}),r(a).then((function(){e.props.history.push("/me")})))}}))},e.onInputChange=function(t){e.setState({form:Object(C.a)({},e.state.form,Object(O.a)({},t.target.name,t.target.value))})},e}return Object(u.a)(a,[{key:"render",value:function(){var e=this.state.message,t=e.text?c.a.createElement("div",{className:"mb-3",style:{color:e.color}},e.text):null;return c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-4"},c.a.createElement("h3",{className:"mb-4"},"Login"),c.a.createElement("form",{onSubmit:this.login},c.a.createElement("div",{className:"mb-3"},c.a.createElement("div",{className:"form-group"},c.a.createElement("input",{type:"text",onChange:this.onInputChange,name:"email",className:"form-control",placeholder:"Email"})),c.a.createElement("div",{className:"form-group"},c.a.createElement("input",{type:"password",onChange:this.onInputChange,name:"password",className:"form-control",placeholder:"Password"}))),t,c.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Sign in"))))}}]),a}(c.a.Component),w=A(Object(o.b)((function(e){return{token:e.user.token}}),(function(e,t){var a=t.apiService;t.token;return{actionGetUserData:function(t){return e(f(a,t)())},actionAuthorize:function(t){return e(function(e){var t=e.auth,a=e.token;return localStorage.setItem("userData",a),{type:"USER_AUTHORIZE",payload:{auth:t,token:a}}}(t))}}}))(k)),U=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,c=new Array(n),r=0;r<n;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).state={form:{name:"",email:"",password:""},message:{color:"red",text:""}},e.register=function(t){t.preventDefault(),e.props.apiService.register(e.state.form).then((function(t){var a=t.errors?"red":"green";t.errors?e.setState({message:{color:a,text:t.message}}):e.setState({message:{color:a,text:t.message},form:{name:"",email:"",password:""}})})).catch((function(e){console.log(e)}))},e.onInputChange=function(t){e.setState({form:Object(C.a)({},e.state.form,Object(O.a)({},t.target.name,t.target.value))})},e}return Object(u.a)(a,[{key:"render",value:function(){var e=this.state.message,t=e.text?c.a.createElement("div",{className:"mb-3",style:{color:e.color}},e.text):null;return c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-4"},c.a.createElement("h3",{className:"mb-4"},"Register"),c.a.createElement("form",{onSubmit:this.register},c.a.createElement("div",{className:"mb-3"},c.a.createElement("div",{className:"form-group"},c.a.createElement("input",{type:"text",onChange:this.onInputChange,name:"name",className:"form-control",placeholder:"Name",value:this.state.form.name})),c.a.createElement("div",{className:"form-group"},c.a.createElement("input",{type:"text",onChange:this.onInputChange,name:"email",className:"form-control",placeholder:"Email",value:this.state.form.email})),c.a.createElement("div",{className:"form-group"},c.a.createElement("input",{type:"password",onChange:this.onInputChange,name:"password",className:"form-control",placeholder:"Password",value:this.state.form.password}))),t,c.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Register"))))}}]),a}(c.a.Component),M=A(Object(o.b)((function(e){return{}}),(function(e){return{checkAuth:function(){}}}))(U)),I=Object(p.g)((function(e){var t=e.messagesList,a=e.openChat;return c.a.createElement("ul",{className:"collection with-header"},t.map((function(e,t){return c.a.createElement("li",{key:t,className:"collection-item"},c.a.createElement("div",{className:"message-item"},c.a.createElement("div",{className:"message-item__content"},e.name),c.a.createElement("div",{className:"message-item__actions"},e.updated?c.a.createElement("button",{onClick:function(){return a(e.id)},className:"btn btn-outline btn-danger btn-sm"},c.a.createElement("i",{className:"fa fa-envelope-open"})):null,c.a.createElement("button",{onClick:function(){return a(e.id)},className:"btn btn-outline btn-success btn-sm ml-3"},c.a.createElement("i",{className:"fa fa-weixin"})))))})))})),x=function(){return c.a.createElement("div",{className:"preloader-wrapper big active"},c.a.createElement("div",{className:"spinner-layer spinner-blue-only"},c.a.createElement("div",{className:"circle-clipper left"},c.a.createElement("div",{className:"circle"})),c.a.createElement("div",{className:"gap-patch"},c.a.createElement("div",{className:"circle"})),c.a.createElement("div",{className:"circle-clipper right"},c.a.createElement("div",{className:"circle"}))))},R=a(6),H=function(e){return function(t){return function(a){var n;a({type:"FETCH_MESSAGES",payload:n}),e.getListMessages(t).then((function(e){a(function(e){return{type:"FETCH_MESSAGES_SUCCESS",payload:e}}(e.messages))}))}}},D=function(e){return{type:"MESSAGE_UPDATE",payload:e}},L=function(e){return{type:"MESSAGES_LIST_UPDATE",payload:e}},G=function(e){return{type:"MESSAGES_LIST_SORT",payload:e.id}},P=function(e){return function(t,a){return function(n){return n({type:"FETCH_CHAT"}),e.getChatMessages(t,a).then((function(e){n({type:"FETCH_CHAT_SUCCESS",payload:e}),n(D({id:a,updated:!1,sort:!1}))}))}}},F=function(e){return{type:"CHAT_STATUS_UPDATE",payload:{inChat:e.inChat,chatId:e.chatId}}},q=function(e){return{type:"CHAT_MESSAGE_ADD",payload:{name:e.name,text:e.text}}},J=function(e){return function(t,a,n){return function(c){var r=t.id,s={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.token)},body:JSON.stringify({id:r,senderId:a.id,message:n})};e.getRequest("sendMessage",s),c(q(n));var o=Object(C.a)({},n,{name:t.name});c(D({id:r,updated:!1,message:o,sort:!0}))}}},z=A(Object(o.b)((function(e){return{user:e.user}}),(function(e,t){var a=t.apiService;return Object(R.b)({fetchChat:P(a),actionUpdateChatStatus:F,actionSendMessage:J(a)},e)}))((function(e){var t=e.backToMessages,a=e.chatLoading,r=e.user,s=e.companionId,l=e.fetchChat,i=e.actionUpdateChatStatus,u=e.actionSendMessage,m=Object(n.useState)(""),d=Object(E.a)(m,2),p=d[0],h=d[1],f=Object(o.c)((function(e){return e.chat.messages})),g=Object(o.c)((function(e){return e.chat.companion})),v=Object(n.useRef)(null);Object(n.useEffect)((function(){return i({inChat:!0,chatId:s}),l(r.id,s),function(){i({inChat:!1,chatId:null})}}),[]),Object(n.useEffect)((function(){v.current.scrollTop=v.current.scrollHeight}),[f]);return c.a.createElement("div",{className:"chat"},c.a.createElement("div",{className:"chat__back"},c.a.createElement("button",{onClick:t,className:"btn btn-primary"},"Back")),c.a.createElement("div",{className:"chat__block"},c.a.createElement("div",{className:"chat__left"},a?c.a.createElement(x,null):c.a.createElement("div",{ref:v,className:"chat__list"},f.map((function(e,t){return c.a.createElement("div",{key:t,className:"chat__item"},c.a.createElement("strong",null,e.name),": ",e.text)}))),c.a.createElement("div",{className:"chat__control"},c.a.createElement("form",{onSubmit:function(e){e.preventDefault();var t={id:s,name:g.name};!function(e,t){var a={name:r.name,text:e};u(t,r,a)}(p,t),h("")},className:"chat-control"},c.a.createElement("div",{className:"chat-control__left"},c.a.createElement("input",{onChange:function(e){return h(e.target.value)},type:"text",className:"form-control",value:p})),c.a.createElement("div",{className:"chat-control__right"},c.a.createElement("button",{className:"btn btn-success"},"Send"))))),c.a.createElement("div",{className:"chat__right"},c.a.createElement("div",{className:"chat__companion"},g.name||c.a.createElement(x,null)))))}))),B=a(43),Z=a.n(B),W=(a(71),A(Object(o.b)((function(e){return{user:e.user,messages:e.messages}}),(function(e,t){var a=t.apiService;return Object(R.b)({actionFetchMessages:H(a),updateMessagesList:L},e)}))(Object(p.g)((function(e){var t=e.user,a=e.actionFetchMessages,r=Z.a.parse(e.location.search),s=!1;r.chat&&(s=!0);var l=Object(n.useState)(s),i=Object(E.a)(l,2),u=i[0],m=i[1],d=Object(o.c)((function(e){return e.chat.loading})),p=Object(o.c)((function(e){return e.messages.loading})),h=Object(o.c)((function(e){return e.messages.messages}));Object(n.useEffect)((function(){a(t.id)}),[]);var f=u?c.a.createElement(z,{backToMessages:function(){e.history.push("./"),m(!1)},companionId:r.chat,chatLoading:d}):c.a.createElement(I,{openChat:function(t){return m({show:!0,receiverId:a=t}),void e.history.push("?chat=".concat(a));var a},messagesList:h});return c.a.createElement("div",null,c.a.createElement("h3",{className:"mb-4"},"Messages"),p?c.a.createElement(x,null):c.a.createElement("div",{className:"messages"},c.a.createElement("div",{className:"messages__left"},f)))}))))),K=(a(72),A(Object(o.b)((function(e){return{}}))((function(e){return c.a.createElement("div",null,c.a.createElement("h2",null,"Me"),c.a.createElement("div",{className:"me pt-4"},c.a.createElement("div",{className:"me__block"},c.a.createElement("div",{className:"me__avatar"},c.a.createElement("img",{src:"https://img2.freepng.ru/20180626/fhs/kisspng-avatar-user-computer-icons-software-developer-5b327cc98b5780.5684824215300354015708.jpg",alt:""}),c.a.createElement("div",{className:"me__avatar-edit"},c.a.createElement("div",{className:"avatar-loader"},c.a.createElement("div",{className:"avatar-loader__left"},c.a.createElement("input",{className:"form-control",placeholder:"Image URL",type:"text"})),c.a.createElement("div",{className:"avatar-loader__right"},c.a.createElement("button",{className:"btn btn-primary"},"Edit"))))),c.a.createElement("div",{className:"me__info"},c.a.createElement("div",{className:"me__name"},"Name: Den")))))})))),Y=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"componentDidMount",value:function(){this.props.user.auth&&this.longpoll()}},{key:"longpoll",value:function(){var e=this,t=this.props,a=t.apiService,n=t.user,c=t.updateMessageInList,r=t.addChatMessage;a.getRequest("longpoll?id=".concat(n.id)).then((function(t){console.log(t);var n=e.props.chat,s=n.inChat,o=n.chatId;"timeout"!==t.type?(s&&o.toString()===t.senderId.toString()?(r(t.message),a.updateChatTime(t.id,t.senderId)):(window.M.toast({html:"<b>".concat(t.message.name,"</b>: ").concat(t.message.text)}),c({id:t.senderId,updated:!0,message:t.message})),e.longpoll()):e.longpoll()})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){return c.a.createElement("div",{className:"App"},c.a.createElement(g,null),c.a.createElement("div",{className:"content pt-3"},c.a.createElement("div",{className:"container"},c.a.createElement(p.d,null,c.a.createElement(p.b,{path:"/",exact:!0,component:v}),c.a.createElement(y,{exact:!0,path:"/cart",component:h}),c.a.createElement(p.b,{path:"/store",component:S}),c.a.createElement(y,{exact:!0,path:"/me",component:K}),c.a.createElement(y,{exact:!0,path:"/messages/",component:W}),c.a.createElement(p.b,{path:"/login",component:w}),c.a.createElement(p.b,{path:"/register",component:M}),c.a.createElement(p.b,{path:"/test",render:function(){return c.a.createElement("h2",null,"Test page")}})))))}}]),a}(c.a.Component),$=A(Object(o.b)((function(e){return{getNewMessage:e.messages.getNewMessage,user:e.user,chat:e.chat}}),(function(e){return Object(R.b)({updateMessageInList:D,sortMessagesList:G,addChatMessage:q},e)}))(Y));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Q=a(46),V=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,c=new Array(n),r=0;r<n;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).status=401,e}return a}(Object(Q.a)(Error)),X=function(){function e(){var t=this;Object(i.a)(this,e),this.URL="http://localhost:9000/api/",this.getUserData=function(e){return t.getRequest("userData",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}})},this.getChatMessages=function(e,a){return t.getRequest("chatMessages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,receiverId:a})})},this.getListMessages=function(e){return t.getRequest("listMessages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})}}return Object(u.a)(e,[{key:"getRequest",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e4;return new Promise((function(c,r){if(fetch("".concat(t.URL).concat(e),a).then((function(e){return 401===e.status&&r(new V),e.json()})).then((function(e){return c(e)})),n){var s=new Error("Connection timed out");setTimeout(r,n,s)}}))}},{key:"login",value:function(e){return this.getRequest("login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}},{key:"register",value:function(e){return console.log(JSON.stringify(e)),this.getRequest("register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}},{key:"updateChatTime",value:function(e,t){return this.getRequest("chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,receiverId:t})})}}]),e}(),ee=(a(73),{name:null,auth:!1,token:null,id:null}),te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_USER_SUCCESS":case"AUTH_CHECK_SUCCESS":case"USER_AUTHORIZE":return Object(C.a)({},e,{},t.payload);case"USER_UNAUTHORIZE":return{name:null,auth:!1,token:null};default:return e}},ae=a(31),ne={loading:!0,messages:[]},ce=function(e,t,a){return{name:e,id:t,updated:a}},re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_MESSAGES":return{loading:!0,messages:[]};case"FETCH_MESSAGES_SUCCESS":return{loading:!1,messages:t.payload};case"MESSAGE_UPDATE":var a=t.payload,n=a.id,c=a.updated,r=a.message,s=a.sort,o=void 0===s||s,l=e.messages.findIndex((function(e){return e.id===n})),i=Object(ae.a)(e.messages);if(o){var u=r.name;l>=0&&(u=i[l].name,i=i.filter((function(e){return e.id!==n}))),i.unshift(ce(u,n,c))}else l>=0&&(i[l].updated=c);return Object(C.a)({},e,{messages:i});case"MESSAGES_LIST_UPDATE":return Object(C.a)({},e,{messages:t.payload});default:return e}},se={messages:[],loading:!1,inChat:!1,chatId:null,companion:{}},oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_CHAT":return Object(C.a)({},e,{loading:!0});case"FETCH_CHAT_SUCCESS":return Object(C.a)({},e,{messages:t.payload.messages,companion:{name:t.payload.companion.name},loading:!1});case"CHAT_STATUS_UPDATE":var a=t.payload,n=a.inChat,c=void 0!==n&&n,r=a.chatId,s=void 0===r?null:r;return Object(C.a)({},e,{inChat:c,chatId:s});case"CHAT_MESSAGE_ADD":return Object(C.a)({},e,{messages:[].concat(Object(ae.a)(e.messages),[t.payload])});default:return e}},le=Object(R.c)({user:te,messages:re,chat:oe}),ie=a(44),ue=a(45);a(18),a(32),new X;var me=Object(ue.a)(),de=Object(R.e)(le,Object(R.d)(Object(R.a)(ie.a,me,(function(){return function(e){return function(t){return console.log(t),e(t)}}})))),pe=new X,he=localStorage.getItem("userData");function fe(){s.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(o.a,{store:de},c.a.createElement(_,{value:pe},c.a.createElement(l.a,null,c.a.createElement($,null))))),document.getElementById("root"))}he?de.dispatch(f(pe,he)()).then((function(e){fe()})):fe(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[48,1,2]]]);
//# sourceMappingURL=main.a84c838e.chunk.js.map